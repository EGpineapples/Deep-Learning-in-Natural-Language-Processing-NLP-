---
jupyter:
  accelerator: GPU
  colab:
    gpuType: T4
    machine_shape: hm
  kernelspec:
    display_name: ai605
    language: python
    name: ai605
  language_info:
    codemirror_mode:
      name: ipython
      version: 3
    file_extension: .py
    mimetype: text/x-python
    name: python
    nbconvert_exporter: python
    pygments_lexer: ipython3
    version: 3.10.13
  nbformat: 4
  nbformat_minor: 5
  widgets:
    application/vnd.jupyter.widget-state+json:
      03a7ebc9ec2a4862af475cd3afd3d300:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_9066dbefe3cb42edb1ea2939f138833c
          placeholder: ​
          style: IPY_MODEL_e9b607ebbd2641e2aa27543a06a715d3
          value: " 29.0/29.0 \\[00:00&lt;00:00, 2.76kB/s\\]"
      044073863cd441abb18c81c555723132:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      07de87cfa3a04fb1a466c0d1c1441df1:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      08618c56d00648228d8c2d351d8de7b3:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      091dfefaa4d949b6b07a7081ea65705d:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      0b77b9ddfe61447e86e64d9049251659:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      0c1c688c3a264d36832ce12c6c32e0fe:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      0f72599fc47a43168cf09e855ee08479:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      10ac8efaab1f40daa2d8ab7915b87dbd:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      14046a0ff55c4e568acb6467283c0a43:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      186f8b88b1dd4ab89c5f2b4c40e45288:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      18ce906383df423784f4b913180e64de:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      19eb38a1e7dc43d49051c27a77d49b5f:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_328a9b12e30b414db818c48d2456b0d6
          - IPY_MODEL_8036696796364ab6a046042ceb5fbf84
          - IPY_MODEL_9d7ec8edacc440288e5a867584e77c90
          layout: IPY_MODEL_591100c00a43490187ab03fa8d70d9f1
      1a453e1e63404e37be26376b6d2bfd22:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      1ae08e3ada0d4e6199e595b89f2660c4:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      1e77db20d5204ca096135b2854283217:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_36139310ac06450cb3443bec48f566ce
          max: 124
          min: 0
          orientation: horizontal
          style: IPY_MODEL_4e9fbd9cb1c34a6b8c78c24d6e850f5d
          value: 124
      22b79906566a41dda9c5e6240048408b:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      23ed45bf3aba45eaaf79bde251d01839:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_3d9217461dd5449a90e99bd279844803
          - IPY_MODEL_4470621d2dac41e6a4b80d87c78a7275
          - IPY_MODEL_4abfed4a04ec4f168d96ed3490381b9e
          layout: IPY_MODEL_22b79906566a41dda9c5e6240048408b
      282420c0e21a41a98d4bbad1e5932a13:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      29bf9df82e2945e8a910bdc01fddd861:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      2c2c4dd3690746bd96f5cb3b03b84831:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_ce40fdf890fd4e9b8d25006a63b75d09
          placeholder: ​
          style: IPY_MODEL_cb9a8872a4f94ab2b41ce9fed5ea9128
          value: "tokenizer.json: 100%"
      2f8467399c71488180461f0f7e308bd8:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_4d85bee2726f4a228945e0e27604b69a
          max: 1042301
          min: 0
          orientation: horizontal
          style: IPY_MODEL_5cfd992a560b4369846f111b2f9db270
          value: 1042301
      303110631f1a4f59975c7c935141482b:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      3236344d62714781a2480fb9a4e35cec:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_4f9efb829a174b4cb8aac7e0305437ac
          placeholder: ​
          style: IPY_MODEL_091dfefaa4d949b6b07a7081ea65705d
          value: "vocab.txt: 100%"
      328a9b12e30b414db818c48d2456b0d6:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_9b307e28c0464d1ebc10b4f641f3b088
          placeholder: ​
          style: IPY_MODEL_18ce906383df423784f4b913180e64de
          value: "tokenizer.json: 100%"
      3329d2f1cdd2412fb1069372614e695f:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_fc267a0c8ff64e9690e05b9de7e2e405
          - IPY_MODEL_1e77db20d5204ca096135b2854283217
          - IPY_MODEL_416425cff4634fc38ea8754f8b16c338
          layout: IPY_MODEL_5a4d0488d84d49cd8a183c6d15234dc7
      355a7cf031b74135b201d4b080bafab9:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_7a425fd651ca49da881729accf3610eb
          placeholder: ​
          style: IPY_MODEL_5d4588c20b01465994942728a1c4b16f
          value: " 570/570 \\[00:00&lt;00:00, 46.0kB/s\\]"
      36139310ac06450cb3443bec48f566ce:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      39c8aeaf2ee4446fa2300df5765d39db:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      3d21379e6b8b4bd3a883bf2d2fbb91ff:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_8b8743764ba44c30865112258266b92c
          placeholder: ​
          style: IPY_MODEL_0c1c688c3a264d36832ce12c6c32e0fe
          value: " 548M/548M \\[00:07&lt;00:00, 81.7MB/s\\]"
      3d274f9ac6514ea1adc664990756ff57:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      3d2c65332cae410d80a686e0866b5010:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_f6bf8a7ff2af4ef88609cf3258c3a181
          - IPY_MODEL_b4b84d9e099146d8acf2f963b5864c32
          - IPY_MODEL_355a7cf031b74135b201d4b080bafab9
          layout: IPY_MODEL_61fe90098bc2447e8bc4b62561fb40a6
      3d9217461dd5449a90e99bd279844803:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_450156be1fff480288053d3f1787dc27
          placeholder: ​
          style: IPY_MODEL_cdd2b2b1742d49f2bd3cf198dae57400
          value: "model.safetensors: 100%"
      400fab9488e7456988b7220cb82c42ee:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_d83674d07c714ca7912ba800a671e610
          placeholder: ​
          style: IPY_MODEL_c56c60202c174c8eb8a0aac380bdf821
          value: "config.json: 100%"
      416425cff4634fc38ea8754f8b16c338:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_7990e4cbd0454c3280776c4fcc7ec9ff
          placeholder: ​
          style: IPY_MODEL_10ac8efaab1f40daa2d8ab7915b87dbd
          value: " 124/124 \\[00:00&lt;00:00, 10.5kB/s\\]"
      4470621d2dac41e6a4b80d87c78a7275:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_0f72599fc47a43168cf09e855ee08479
          max: 435755784
          min: 0
          orientation: horizontal
          style: IPY_MODEL_5636da7693454bfe9632251b6b6deac7
          value: 435755784
      450156be1fff480288053d3f1787dc27:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      45d789ef1b8f48ffbda028d29c43df33:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_c190cdde997c4721b0be8020d5fc12b5
          - IPY_MODEL_2f8467399c71488180461f0f7e308bd8
          - IPY_MODEL_b574af5ea16b4098b953ab9780a25e02
          layout: IPY_MODEL_ccf66640f62e4253bc3d63898cc420c4
      4893fea2ceee4fdcb6088cbccb6f2f8e:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      4abfed4a04ec4f168d96ed3490381b9e:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_4cc5e10f339249869d94543b32203b67
          placeholder: ​
          style: IPY_MODEL_9b3fd29d81e74e068188db6b587d02ac
          value: " 436M/436M \\[00:08&lt;00:00, 46.7MB/s\\]"
      4c00a0b3be414171adf38fcce5289899:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_282420c0e21a41a98d4bbad1e5932a13
          max: 1355256
          min: 0
          orientation: horizontal
          style: IPY_MODEL_dd8c336fdd874645a725970a0db48bc0
          value: 1355256
      4cc5e10f339249869d94543b32203b67:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      4d85bee2726f4a228945e0e27604b69a:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      4e9fbd9cb1c34a6b8c78c24d6e850f5d:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      4f9efb829a174b4cb8aac7e0305437ac:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      5100f756df5e4df4a7fe10e424c53b62:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_8adf9d82d7af4410908dfee0f5bca9ef
          - IPY_MODEL_f3b0e38a0b664476bece61c2ac49617b
          - IPY_MODEL_6cf4108506de44b3b7720f1a7f253b0f
          layout: IPY_MODEL_9c2ff1d4402a428bb5839b55012a612a
      5582f2861f5e45bf8dd68769cae5447e:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_d10489efc6104b058f706ac8479791aa
          placeholder: ​
          style: IPY_MODEL_303110631f1a4f59975c7c935141482b
          value: "model.safetensors: 100%"
      5636da7693454bfe9632251b6b6deac7:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      587270237d9e45f0bc8099d20b99ea91:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_5582f2861f5e45bf8dd68769cae5447e
          - IPY_MODEL_ea674f9ed0864aceb3a27fc0b814c2d5
          - IPY_MODEL_3d21379e6b8b4bd3a883bf2d2fbb91ff
          layout: IPY_MODEL_7347e2b2bab442e3b6d1187e4d0cc29d
      591100c00a43490187ab03fa8d70d9f1:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      5a4d0488d84d49cd8a183c6d15234dc7:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      5cfd992a560b4369846f111b2f9db270:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      5d4588c20b01465994942728a1c4b16f:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      61fe90098bc2447e8bc4b62561fb40a6:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      63186cb3aea843d98570b268127eceb4:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      67672831d5e741b1af9348067b80f087:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      676b4dd61d6c4a24b29d194a2d0b4645:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      678edfe7f4f44ef4a8f36573d719f700:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      686bd24d0ee7404ba9b28e82f6f441c1:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      6a5cd804360b4911b2f9146ce2ee01e4:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_d3655e0c0bd4460fa873189ab3f2de8b
          placeholder: ​
          style: IPY_MODEL_4893fea2ceee4fdcb6088cbccb6f2f8e
          value: " 456k/456k \\[00:00&lt;00:00, 777kB/s\\]"
      6c3401dc790b4379b507253b8e4fce63:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      6cd2e50c33e4416085d8d970ee279a5b:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      6cf4108506de44b3b7720f1a7f253b0f:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_08618c56d00648228d8c2d351d8de7b3
          placeholder: ​
          style: IPY_MODEL_cc489d08eb8048e28c2ba1bf284fc7ed
          value: " 5000/5000 \\[00:01&lt;00:00, 2939.10 examples/s\\]"
      6fab5ffee63b4d7ea377a8eebacfaa3a:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      7347e2b2bab442e3b6d1187e4d0cc29d:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      75d5bdd2e9f844c0804ea0172f974a59:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_bccaa2ad39a64417930052a24b02253a
          placeholder: ​
          style: IPY_MODEL_8425cf6d357e47078404a61eb8ba9dc5
          value: " 213k/213k \\[00:00&lt;00:00, 549kB/s\\]"
      75eca3b3cba14d448ef127e15b23a97e:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      75f601f0da534a5395aab396a04203f5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_d199b2dad76e4025a00c806b233d884c
          placeholder: ​
          style: IPY_MODEL_9c8a805e7e2246cebcadf5ea4970ca14
          value: " 665/665 \\[00:00&lt;00:00, 52.7kB/s\\]"
      7990e4cbd0454c3280776c4fcc7ec9ff:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      7a425fd651ca49da881729accf3610eb:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      8036696796364ab6a046042ceb5fbf84:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_39c8aeaf2ee4446fa2300df5765d39db
          max: 435797
          min: 0
          orientation: horizontal
          style: IPY_MODEL_d36ddc16f9f249a9a29e48fe710d9b53
          value: 435797
      8425cf6d357e47078404a61eb8ba9dc5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      84dac9bcb30748eda0611a7bc6afa64d:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      85d796e567b9473ab291e6653c06daf0:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      86d884361a84486998191d7da5f9886c:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      870e347cc6d84f37b2e5699d4a23d57d:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      87e1671ddbc445afbd37ca16839c5b56:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      8824def0333243179a96b6957ec2103f:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_6c3401dc790b4379b507253b8e4fce63
          placeholder: ​
          style: IPY_MODEL_0b77b9ddfe61447e86e64d9049251659
          value: "tokenizer_config.json: 100%"
      8adf9d82d7af4410908dfee0f5bca9ef:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_678edfe7f4f44ef4a8f36573d719f700
          placeholder: ​
          style: IPY_MODEL_1ae08e3ada0d4e6199e595b89f2660c4
          value: "Map: 100%"
      8b8743764ba44c30865112258266b92c:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      902000b3779f4f08a33db169b4fadfbb:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_3236344d62714781a2480fb9a4e35cec
          - IPY_MODEL_bfe2e28c718f41b9844f9cee19eed313
          - IPY_MODEL_75d5bdd2e9f844c0804ea0172f974a59
          layout: IPY_MODEL_67672831d5e741b1af9348067b80f087
      9066dbefe3cb42edb1ea2939f138833c:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      92c30a7979ab4c4eb96ca7bcf6e7c4ae:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      94dc16aac7c549ab9858fab191452dbc:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      9b307e28c0464d1ebc10b4f641f3b088:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      9b3fd29d81e74e068188db6b587d02ac:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      9bb243caf6e8449bbfb7252a600ae8c5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      9bce728b5d7c461dbcb6c5fbac237b29:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      9c2ff1d4402a428bb5839b55012a612a:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      9c8a805e7e2246cebcadf5ea4970ca14:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      9d7ec8edacc440288e5a867584e77c90:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_e4e23d2220a0436fa1d8b66218919225
          placeholder: ​
          style: IPY_MODEL_d375433acaf14a0a85559788055c3bd5
          value: " 436k/436k \\[00:00&lt;00:00, 747kB/s\\]"
      a1130ccc48e247908ace5594e3207849:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      a2e763a121144350b2559b1ba47875d5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_186f8b88b1dd4ab89c5f2b4c40e45288
          max: 456318
          min: 0
          orientation: horizontal
          style: IPY_MODEL_87e1671ddbc445afbd37ca16839c5b56
          value: 456318
      a37eb08b6e8b41ffb4657a495f700fe9:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_2c2c4dd3690746bd96f5cb3b03b84831
          - IPY_MODEL_4c00a0b3be414171adf38fcce5289899
          - IPY_MODEL_ce4eef0cb7384e6ab17c6102194dca3e
          layout: IPY_MODEL_29bf9df82e2945e8a910bdc01fddd861
      acb8f7d2f347424eae0d7e40313eef33:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_400fab9488e7456988b7220cb82c42ee
          - IPY_MODEL_d462685e7d25435bbfb4cc2a6e4fa172
          - IPY_MODEL_75f601f0da534a5395aab396a04203f5
          layout: IPY_MODEL_84dac9bcb30748eda0611a7bc6afa64d
      adcca0b700564710b3d05368a7c60fac:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_3d274f9ac6514ea1adc664990756ff57
          placeholder: ​
          style: IPY_MODEL_e65f1f9ff6b1470f97407fce4b6b5e91
          value: "merges.txt: 100%"
      b4b84d9e099146d8acf2f963b5864c32:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_686bd24d0ee7404ba9b28e82f6f441c1
          max: 570
          min: 0
          orientation: horizontal
          style: IPY_MODEL_f8acce9c8f5e436faca258058a4776d0
          value: 570
      b574af5ea16b4098b953ab9780a25e02:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_92c30a7979ab4c4eb96ca7bcf6e7c4ae
          placeholder: ​
          style: IPY_MODEL_07de87cfa3a04fb1a466c0d1c1441df1
          value: " 1.04M/1.04M \\[00:00&lt;00:00, 1.33MB/s\\]"
      b5d91f090a1b4c4590efccee7fb78ab7:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      bccaa2ad39a64417930052a24b02253a:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      bfe2e28c718f41b9844f9cee19eed313:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_9bce728b5d7c461dbcb6c5fbac237b29
          max: 213450
          min: 0
          orientation: horizontal
          style: IPY_MODEL_de5cb544a6344e39aa2bf429f4b4d921
          value: 213450
      c190cdde997c4721b0be8020d5fc12b5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_75eca3b3cba14d448ef127e15b23a97e
          placeholder: ​
          style: IPY_MODEL_9bb243caf6e8449bbfb7252a600ae8c5
          value: "vocab.json: 100%"
      c56c60202c174c8eb8a0aac380bdf821:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      cb9a8872a4f94ab2b41ce9fed5ea9128:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      cc489d08eb8048e28c2ba1bf284fc7ed:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      ccf66640f62e4253bc3d63898cc420c4:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      cdd2b2b1742d49f2bd3cf198dae57400:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      ce40fdf890fd4e9b8d25006a63b75d09:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      ce4eef0cb7384e6ab17c6102194dca3e:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_86d884361a84486998191d7da5f9886c
          placeholder: ​
          style: IPY_MODEL_1a453e1e63404e37be26376b6d2bfd22
          value: " 1.36M/1.36M \\[00:00&lt;00:00, 2.31MB/s\\]"
      cebd4cfd342740a696ae10c187656285:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      d10489efc6104b058f706ac8479791aa:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      d199b2dad76e4025a00c806b233d884c:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      d3655e0c0bd4460fa873189ab3f2de8b:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      d36ddc16f9f249a9a29e48fe710d9b53:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      d375433acaf14a0a85559788055c3bd5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      d462685e7d25435bbfb4cc2a6e4fa172:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_870e347cc6d84f37b2e5699d4a23d57d
          max: 665
          min: 0
          orientation: horizontal
          style: IPY_MODEL_6fab5ffee63b4d7ea377a8eebacfaa3a
          value: 665
      d83674d07c714ca7912ba800a671e610:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      dd8c336fdd874645a725970a0db48bc0:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      de5cb544a6344e39aa2bf429f4b4d921:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      e191030d9ec0418e8f522ebd0ecee3a9:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      e46138876b074ca4a833910b7f04e8b3:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_8824def0333243179a96b6957ec2103f
          - IPY_MODEL_eef056178b5e4e8197c9190af6c4aecf
          - IPY_MODEL_03a7ebc9ec2a4862af475cd3afd3d300
          layout: IPY_MODEL_a1130ccc48e247908ace5594e3207849
      e4728ad5c615490c80e841e7f5301408:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      e4e23d2220a0436fa1d8b66218919225:
        model_module: \@jupyter-widgets/base
        model_module_version: 1.2.0
        model_name: LayoutModel
        state:
          _model_module: \@jupyter-widgets/base
          _model_module_version: 1.2.0
          _model_name: LayoutModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: LayoutView
      e65f1f9ff6b1470f97407fce4b6b5e91:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      e9b607ebbd2641e2aa27543a06a715d3:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: DescriptionStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: DescriptionStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      ea674f9ed0864aceb3a27fc0b814c2d5:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_cebd4cfd342740a696ae10c187656285
          max: 548105171
          min: 0
          orientation: horizontal
          style: IPY_MODEL_6cd2e50c33e4416085d8d970ee279a5b
          value: 548105171
      eaba3ce33a8d49d39a4ef8f119c19557:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HBoxModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HBoxModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HBoxView
          children:
          - IPY_MODEL_adcca0b700564710b3d05368a7c60fac
          - IPY_MODEL_a2e763a121144350b2559b1ba47875d5
          - IPY_MODEL_6a5cd804360b4911b2f9146ce2ee01e4
          layout: IPY_MODEL_676b4dd61d6c4a24b29d194a2d0b4645
      eef056178b5e4e8197c9190af6c4aecf:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_63186cb3aea843d98570b268127eceb4
          max: 29
          min: 0
          orientation: horizontal
          style: IPY_MODEL_e191030d9ec0418e8f522ebd0ecee3a9
          value: 29
      f3b0e38a0b664476bece61c2ac49617b:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: FloatProgressModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: FloatProgressModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: ProgressView
          bar_style: success
          layout: IPY_MODEL_b5d91f090a1b4c4590efccee7fb78ab7
          max: 5000
          min: 0
          orientation: horizontal
          style: IPY_MODEL_94dc16aac7c549ab9858fab191452dbc
          value: 5000
      f6bf8a7ff2af4ef88609cf3258c3a181:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_e4728ad5c615490c80e841e7f5301408
          placeholder: ​
          style: IPY_MODEL_044073863cd441abb18c81c555723132
          value: "config.json: 100%"
      f8acce9c8f5e436faca258058a4776d0:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: ProgressStyleModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: ProgressStyleModel
          _view_module: \@jupyter-widgets/base
          _view_module_version: 1.2.0
          _view_name: StyleView
      fc267a0c8ff64e9690e05b9de7e2e405:
        model_module: \@jupyter-widgets/controls
        model_module_version: 1.5.0
        model_name: HTMLModel
        state:
          _model_module: \@jupyter-widgets/controls
          _model_module_version: 1.5.0
          _model_name: HTMLModel
          _view_module: \@jupyter-widgets/controls
          _view_module_version: 1.5.0
          _view_name: HTMLView
          layout: IPY_MODEL_14046a0ff55c4e568acb6467283c0a43
          placeholder: ​
          style: IPY_MODEL_85d796e567b9473ab291e6653c06daf0
          value: "generation_config.json: 100%"
---

::: {#2dc0963f .cell .markdown id="2dc0963f"}
# 2023 Fall AI605 Assignment 4: Parameter Efficient Fine-tuning and Alignment {#2023-fall-ai605-assignment-4-parameter-efficient-fine-tuning-and-alignment}

## Rubric

### Deadline

The deadline for this assignment is: Friday 15th December 2023 (Week 16)
11:59pm

### Submission

Please submit your assignment via [KLMS](https://klms.kaist.ac.kr). You
must submit the Jupyter Notebook file (.ipynb) with all code and model
outputs.

Use in-line LaTeX for mathematical expressions.

### Collaboration

This assignment is an individual assingnment. It is **not** a group
assignment so make sure your answer and code are your own.

Please ensure that you do not violate the class policy on the use of
ChatGPT.

### Grading

The total number of marks avaiable is 25 points.

Bonus questions can be answered for an additional 5 points. You can
freely select bonus questions up to the budget of up to 5 points. If you
select more than 5 marks worth of bonus questions, only the first 5
marks will be evaluated.

If you score \>25 points, these marks will be distributed to your other
assignments.

### Environment

The use of a GPU is recommended for problem 1.4. Limit computation time
to less than 1 hour.

### Data The Yelp dataset for prolem 1.4 can be downloaded through the
HuggingFace datasets library.

### Libraries

The following libraries should be used for the project. You should not
need any other libraries.
:::

::: {#bdc53cd4 .cell .code execution_count="1" colab="{\"base_uri\":\"https://localhost:8080/\"}" id="bdc53cd4" outputId="4d2beae8-a010-4413-a65f-c4206532562c"}
``` python
!pip install torch tqdm datasets transformers evaluate
```

::: {.output .stream .stdout}
    Requirement already satisfied: torch in /usr/local/lib/python3.10/dist-packages (2.1.0+cu121)
    Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (4.66.1)
    Collecting datasets
      Downloading datasets-2.15.0-py3-none-any.whl (521 kB)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 521.2/521.2 kB 5.4 MB/s eta 0:00:00
    ent already satisfied: transformers in /usr/local/lib/python3.10/dist-packages (4.35.2)
    Collecting evaluate
      Downloading evaluate-0.4.1-py3-none-any.whl (84 kB)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 84.1/84.1 kB 7.1 MB/s eta 0:00:00
    ent already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch) (3.13.1)
    Requirement already satisfied: typing-extensions in /usr/local/lib/python3.10/dist-packages (from torch) (4.5.0)
    Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch) (1.12)
    Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch) (3.2.1)
    Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch) (3.1.2)
    Requirement already satisfied: fsspec in /usr/local/lib/python3.10/dist-packages (from torch) (2023.6.0)
    Requirement already satisfied: triton==2.1.0 in /usr/local/lib/python3.10/dist-packages (from torch) (2.1.0)
    Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.10/dist-packages (from datasets) (1.23.5)
    Requirement already satisfied: pyarrow>=8.0.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (10.0.1)
    Collecting pyarrow-hotfix (from datasets)
      Downloading pyarrow_hotfix-0.6-py3-none-any.whl (7.9 kB)
    Collecting dill<0.3.8,>=0.3.0 (from datasets)
      Downloading dill-0.3.7-py3-none-any.whl (115 kB)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 115.3/115.3 kB 7.9 MB/s eta 0:00:00
    ent already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from datasets) (1.5.3)
    Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (2.31.0)
    Requirement already satisfied: xxhash in /usr/local/lib/python3.10/dist-packages (from datasets) (3.4.1)
    Collecting multiprocess (from datasets)
      Downloading multiprocess-0.70.15-py310-none-any.whl (134 kB)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 134.8/134.8 kB 6.8 MB/s eta 0:00:00
    ent already satisfied: aiohttp in /usr/local/lib/python3.10/dist-packages (from datasets) (3.9.1)
    Requirement already satisfied: huggingface-hub>=0.18.0 in /usr/local/lib/python3.10/dist-packages (from datasets) (0.19.4)
    Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from datasets) (23.2)
    Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.10/dist-packages (from datasets) (6.0.1)
    Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers) (2023.6.3)
    Requirement already satisfied: tokenizers<0.19,>=0.14 in /usr/local/lib/python3.10/dist-packages (from transformers) (0.15.0)
    Requirement already satisfied: safetensors>=0.3.1 in /usr/local/lib/python3.10/dist-packages (from transformers) (0.4.1)
    Collecting responses<0.19 (from evaluate)
      Downloading responses-0.18.0-py3-none-any.whl (38 kB)
    Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (23.1.0)
    Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (6.0.4)
    Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.9.4)
    Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.4.0)
    Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (1.3.1)
    Requirement already satisfied: async-timeout<5.0,>=4.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp->datasets) (4.0.3)
    Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (3.3.2)
    Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (3.6)
    Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (2.0.7)
    Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.19.0->datasets) (2023.11.17)
    Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch) (2.1.3)
    Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2.8.2)
    Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas->datasets) (2023.3.post1)
    Requirement already satisfied: mpmath>=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy->torch) (1.3.0)
    Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.1->pandas->datasets) (1.16.0)
    Installing collected packages: pyarrow-hotfix, dill, responses, multiprocess, datasets, evaluate
    Successfully installed datasets-2.15.0 dill-0.3.7 evaluate-0.4.1 multiprocess-0.70.15 pyarrow-hotfix-0.6 responses-0.18.0
:::
:::

::: {#ab7b63e1 .cell .markdown id="ab7b63e1"}
# Problem 1 - Parameter Efficient Fine-Tuning (15 points)
:::

::: {#8f17ec8f .cell .markdown id="8f17ec8f"}
This question is based on the following two papers: \"Low Rank
Adaptation of Large Language Models\" <https://arxiv.org/abs/2106.09685>
and \"Prefix-Tuning: Optimizing Continuous Prompts for Generation\"
<https://arxiv.org/abs/2101.00190>
:::

::: {#1cd16dc1 .cell .markdown id="1cd16dc1"}
**Problem 1.1** A decoder-only langauge model is trained on an
autoregressive (next word prediction) task. The configuration of the
model is as follows:

-   Number of attention heads: 20
-   Number of layers: 36
-   Vocab size: 50257
-   Embedding dimension: 1280
-   Model dimension: 1280
-   Feed-forward intermediate size: 4\* Model dimension

Hint: for multi-head attention attention module inner dimension is
determined related to the number of heads:
<https://arxiv.org/abs/1706.03762> - parameters for layer normalization
can be ignored
:::

::: {#84f9b348-ce10-44cc-8d06-877186dea22c .cell .markdown id="84f9b348-ce10-44cc-8d06-877186dea22c"}
**Problem 1.1a** (2 points) The full model is undergoing supervised
fine-tuning *without* any parameter efficient fine-tuning. Compute the
number of parameters that will be updated. You must show your working.
:::

::: {#5OHFhEneFthy .cell .markdown id="5OHFhEneFthy"}
We calculate the number of parameters updated in the following
components: embeddings, transformer layers, and layer normalization.

For embeddings, the size of each embedding is equal to the embedding
dimension, thus, the total number of parameters for embeddings are 2 x
vocab size x embedding dimension = 50257 x 1280 x 2 = 128,657,920 for
token embeddings and position embeddings.

For transformer layers, we calculate parameters for multi-head attention
and feed-forward network. For multi-head attention, each attention head
has 3 weight matrices (query, key, value) and each matrix is of size
model dimension x (model dimension / number of heads). There is an
output projection matrix of size model dimension x model dimension. And
there are 20 heads, the total parameter count for one multi-head
attention block is 3 x model dimension x model dimension/number of heads
x number of heads + model dimension x model dimension. Total MHA
parameters per layer = 3 x 1280 x 1280/20 x 20 + 1280 x 1280 =
6,553,600. For feed-forward network, the FFN consists of 2 linear layers
where the first layer expands the dimension from model dimension to the
feed-forward intermediate size (4 times model dimension) and second
layer projects it back. The total parameters are model dimension x 4 x
model dimension + 4 x model dimension x model dimension = 1280 x 4 x
1280 + 4 x 1280 x 1280 = 13,107,200.

For the layer normalization as suggested in the hint, we can ignore the
paramters for layer normalization for this calculation.

Thus, the total number of parameters that will be updated during
supervised fine-tuning without any parameter-efficient fine-tuning is
approximately (13,107,200 + 6,553,600) x 36 + 128,657,920 = 836,446,720
.
:::

::: {#da404665-c138-45d0-aef6-6098ef782847 .cell .markdown id="da404665-c138-45d0-aef6-6098ef782847"}
**Problem 1.1b** (2 points) The model undergoes fine-tuning with
prefix-tuning. $16$ prefix vectors are applied for each layer. Compute
the number of parameters that will be updated. You must show your
working. You can give your answer with or without any reparameterization
of the embeddings.
:::

::: {#gVWkIcwpFthy .cell .markdown id="gVWkIcwpFthy"}
Each prefix vector has the same dimension as the model\'s embedding
dimension. Thus, for each layer, we have 16 prefix vectors with size
1280 or 16 x 1280 for each layer and 16 x 1280 x 36 for all layers. The
only parameters updated during prefix-tuning which is 737,280.
:::

::: {#80297f55 .cell .markdown id="80297f55"}
**Problem 1.1c** (2 points) Low Rank Adaptors are applied when
fine-tuning the model. LoRA is applied for the $W_q$, $W_k$, $W_v$, and
$W_o$ matrices for the attention in each layer. Rank $4$ is used for the
low rank adaptor. Compute the number of parameters that will be updated.
You must show your working.
:::

::: {#t0og_wypFthz .cell .markdown id="t0og_wypFthz"}
The total number of paramters updated is 1,474,560. The LoRA
modifications replaces each weight matrix W with W + BA where B and A
are low-rank matrices (B is 1280 x 4 and A is 4 x 1280 for each of the
four Wq, Wk, Wv, and Wo matrices). Total parameters for one matrix are 2
x 1280 x 4 which is multiplied by 4 for each matrix and by 36 for each
layer = 2 x 1280 x 4 x 4 x 36 = 1,474,560.
:::

::: {#e3ea2cb3 .cell .markdown id="e3ea2cb3"}
**Problem 1.2** (2 points) A researcher at an AI lab has trained a GPT
base model with a supervised fine tuning on the FLAN instruction tuning
dataset. She then deploys the model for internal testing and collects
preference data from human testers. She plans to further adapt the model
with preference data from the human testers using RLHF and LoRA. List
two advantages and one disadvantage of using LoRA when fine-tuning the
model in this setting.
:::

::: {#_okipF_9Fthz .cell .markdown id="_okipF_9Fthz"}
Two advantages include efficient adaptation to specific tasks and
resource optimization during further training. Since the model is
initially fine-tuned on the FLAN dataset and then further adapted using
human preference data using RLHF and LoRA, using LoRA allows for
targeted adaptation. The low-rank updates allows the model to focus on
specifics of the human feedback data. Secondly, LoRA offers a
significant reduction in memory and computational requirements (such as
reduced training time) since the researched is adapting a pre-trianed
model to human preferences. A disadvantage would be the limitations in
capturing complex adaptations as LoRA is not as flexible as full model
retraining, leading to less effective capturing of complex patterns in
the human data.

------------------------------------------------------------------------
:::

::: {#3032f914-1fb3-4f94-bd7b-8f78e9904bad .cell .markdown id="3032f914-1fb3-4f94-bd7b-8f78e9904bad"}
**Problem 1.3** (1 point) The researcher is unsure about whether to use
rank 4 or rank 8 LoRA adaptors for adapting the model. Based on your
understanding of section 7 of the LoRA paper describe the trade-off
being made and determine which rank should be used.
:::

::: {#9BmRwfctFthz .cell .markdown id="9BmRwfctFthz"}
The trade-off in choosing between rank 4 and rank 8 for LoRA adaptors
depends on balancing feature amplification and task specificity. Lower
ranks, like 4, amplify existing features in weight matrices and provide
focused adaptations for specific tasks. On ther other hand, a higher
rank, such as 8, allows for broader adaptations, covering a wider range
of features. Therefore, the researcher should opt for rank 4 if the
downstream tasks demand targeted feature enhancement, and rank 8 for
more varied tasks requiring broader adaptations.
:::

::: {#67cea9a1 .cell .markdown id="67cea9a1"}
**Problem 1.4** (4 points) Implement LoRA on the $W_q$ and $W_k$ matrix
on a BERT model with Rank 4 and fine-tune the a bert-base-cased model on
the Yelp movie reviews dataset. Report the training/validation loss
curves and the validation set accuracy.

We will provide the implementation of the SelfAttention layer in BERT.
Clearly highlight the lines you\'ve changed.
:::

::: {#806a678c .cell .code execution_count="2" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":446,\"referenced_widgets\":[\"3d2c65332cae410d80a686e0866b5010\",\"f6bf8a7ff2af4ef88609cf3258c3a181\",\"b4b84d9e099146d8acf2f963b5864c32\",\"355a7cf031b74135b201d4b080bafab9\",\"61fe90098bc2447e8bc4b62561fb40a6\",\"e4728ad5c615490c80e841e7f5301408\",\"044073863cd441abb18c81c555723132\",\"686bd24d0ee7404ba9b28e82f6f441c1\",\"f8acce9c8f5e436faca258058a4776d0\",\"7a425fd651ca49da881729accf3610eb\",\"5d4588c20b01465994942728a1c4b16f\",\"23ed45bf3aba45eaaf79bde251d01839\",\"3d9217461dd5449a90e99bd279844803\",\"4470621d2dac41e6a4b80d87c78a7275\",\"4abfed4a04ec4f168d96ed3490381b9e\",\"22b79906566a41dda9c5e6240048408b\",\"450156be1fff480288053d3f1787dc27\",\"cdd2b2b1742d49f2bd3cf198dae57400\",\"0f72599fc47a43168cf09e855ee08479\",\"5636da7693454bfe9632251b6b6deac7\",\"4cc5e10f339249869d94543b32203b67\",\"9b3fd29d81e74e068188db6b587d02ac\",\"e46138876b074ca4a833910b7f04e8b3\",\"8824def0333243179a96b6957ec2103f\",\"eef056178b5e4e8197c9190af6c4aecf\",\"03a7ebc9ec2a4862af475cd3afd3d300\",\"a1130ccc48e247908ace5594e3207849\",\"6c3401dc790b4379b507253b8e4fce63\",\"0b77b9ddfe61447e86e64d9049251659\",\"63186cb3aea843d98570b268127eceb4\",\"e191030d9ec0418e8f522ebd0ecee3a9\",\"9066dbefe3cb42edb1ea2939f138833c\",\"e9b607ebbd2641e2aa27543a06a715d3\",\"902000b3779f4f08a33db169b4fadfbb\",\"3236344d62714781a2480fb9a4e35cec\",\"bfe2e28c718f41b9844f9cee19eed313\",\"75d5bdd2e9f844c0804ea0172f974a59\",\"67672831d5e741b1af9348067b80f087\",\"4f9efb829a174b4cb8aac7e0305437ac\",\"091dfefaa4d949b6b07a7081ea65705d\",\"9bce728b5d7c461dbcb6c5fbac237b29\",\"de5cb544a6344e39aa2bf429f4b4d921\",\"bccaa2ad39a64417930052a24b02253a\",\"8425cf6d357e47078404a61eb8ba9dc5\",\"19eb38a1e7dc43d49051c27a77d49b5f\",\"328a9b12e30b414db818c48d2456b0d6\",\"8036696796364ab6a046042ceb5fbf84\",\"9d7ec8edacc440288e5a867584e77c90\",\"591100c00a43490187ab03fa8d70d9f1\",\"9b307e28c0464d1ebc10b4f641f3b088\",\"18ce906383df423784f4b913180e64de\",\"39c8aeaf2ee4446fa2300df5765d39db\",\"d36ddc16f9f249a9a29e48fe710d9b53\",\"e4e23d2220a0436fa1d8b66218919225\",\"d375433acaf14a0a85559788055c3bd5\"]}" id="806a678c" outputId="e5ca0a43-44ae-4a4f-b0d9-9feea875bed3"}
``` python
from transformers.models.bert import modeling_bert
from transformers.models.bert.modeling_bert import BertAttention, BertSelfAttention, BertSelfOutput
from transformers import AutoModel, AutoTokenizer
from torch import nn
import torch
import warnings
from dataclasses import dataclass
from typing import Optional, Tuple, Union
import math
MODEL = 'bert-base-cased'

class BertSelfAttentionLora(nn.Module):
    def __init__(self, config, position_embedding_type=None):
        super().__init__()
        print("USING AI605 Attention")
        if config.hidden_size % config.num_attention_heads != 0 and not hasattr(config, "embedding_size"):
            raise ValueError(
                f"The hidden size ({config.hidden_size}) is not a multiple of the number of attention "
                f"heads ({config.num_attention_heads})"
            )

        self.num_attention_heads = config.num_attention_heads
        self.attention_head_size = int(config.hidden_size / config.num_attention_heads)
        self.all_head_size = self.num_attention_heads * self.attention_head_size

        ##  ADDED CODE
        # LoRA parameters
        self.rank = 4
        self.A_q = nn.Parameter(torch.randn(self.all_head_size, self.rank))
        self.B_q = nn.Parameter(torch.randn(self.rank, config.hidden_size))
        self.A_k = nn.Parameter(torch.randn(self.all_head_size, self.rank))
        self.B_k = nn.Parameter(torch.randn(self.rank, config.hidden_size))
        ##  END OF ADDED CODE

        # Hint: Edit these. Note that BERT model uses 1 large linear layer for all heads.
        # You may have to change this to use 1 small layer for each head.
        self.query = nn.Linear(config.hidden_size, self.all_head_size)
        self.key = nn.Linear(config.hidden_size, self.all_head_size)


        self.value = nn.Linear(config.hidden_size, self.all_head_size)

        self.dropout = nn.Dropout(config.attention_probs_dropout_prob)
        self.position_embedding_type = position_embedding_type or getattr(
            config, "position_embedding_type", "absolute"
        )
        if self.position_embedding_type == "relative_key" or self.position_embedding_type == "relative_key_query":
            self.max_position_embeddings = config.max_position_embeddings
            self.distance_embedding = nn.Embedding(2 * config.max_position_embeddings - 1, self.attention_head_size)

        self.is_decoder = config.is_decoder

    def transpose_for_scores(self, x: torch.Tensor) -> torch.Tensor:
        new_x_shape = x.size()[:-1] + (self.num_attention_heads, self.attention_head_size)
        x = x.view(new_x_shape)
        return x.permute(0, 2, 1, 3)

    def forward(
        self,
        hidden_states: torch.Tensor,
        attention_mask: Optional[torch.FloatTensor] = None,
        head_mask: Optional[torch.FloatTensor] = None,
        encoder_hidden_states: Optional[torch.FloatTensor] = None,
        encoder_attention_mask: Optional[torch.FloatTensor] = None,
        past_key_value: Optional[Tuple[Tuple[torch.FloatTensor]]] = None,
        output_attentions: Optional[bool] = False,
    ) -> Tuple[torch.Tensor]:
        mixed_query_layer = self.query(hidden_states)

        # If this is instantiated as a cross-attention module, the keys
        # and values come from an encoder; the attention mask needs to be
        # such that the encoder's padding tokens are not attended to.
        is_cross_attention = encoder_hidden_states is not None


        value_layer = self.transpose_for_scores(self.value(hidden_states))

        ## ADDED CODE
        # Modify query and key layers with LoRA
        lora_query_layer = self.query(hidden_states) + self.A_q.matmul(self.B_q.matmul(hidden_states.transpose(-1, -2))).transpose(-1, -2)
        lora_key_layer = self.key(hidden_states) + self.A_k.matmul(self.B_k.matmul(hidden_states.transpose(-1, -2))).transpose(-1, -2)

        query_layer = self.transpose_for_scores(lora_query_layer)
        key_layer = self.transpose_for_scores(lora_key_layer)
        ## END OF ADDED CODE

        use_cache = past_key_value is not None
        if self.is_decoder:
            # if cross_attention save Tuple(torch.Tensor, torch.Tensor) of all cross attention key/value_states.
            # Further calls to cross_attention layer can then reuse all cross-attention
            # key/value_states (first "if" case)
            # if uni-directional self-attention (decoder) save Tuple(torch.Tensor, torch.Tensor) of
            # all previous decoder key/value_states. Further calls to uni-directional self-attention
            # can concat previous decoder key/value_states to current projected key/value_states (third "elif" case)
            # if encoder bi-directional self-attention `past_key_value` is always `None`
            past_key_value = (key_layer, value_layer)

        # Take the dot product between "query" and "key" to get the raw attention scores.
        attention_scores = torch.matmul(query_layer, key_layer.transpose(-1, -2))

        if self.position_embedding_type == "relative_key" or self.position_embedding_type == "relative_key_query":
            query_length, key_length = query_layer.shape[2], key_layer.shape[2]
            if use_cache:
                position_ids_l = torch.tensor(key_length - 1, dtype=torch.long, device=hidden_states.device).view(
                    -1, 1
                )
            else:
                position_ids_l = torch.arange(query_length, dtype=torch.long, device=hidden_states.device).view(-1, 1)
            position_ids_r = torch.arange(key_length, dtype=torch.long, device=hidden_states.device).view(1, -1)
            distance = position_ids_l - position_ids_r

            positional_embedding = self.distance_embedding(distance + self.max_position_embeddings - 1)
            positional_embedding = positional_embedding.to(dtype=query_layer.dtype)  # fp16 compatibility

            if self.position_embedding_type == "relative_key":
                relative_position_scores = torch.einsum("bhld,lrd->bhlr", query_layer, positional_embedding)
                attention_scores = attention_scores + relative_position_scores
            elif self.position_embedding_type == "relative_key_query":
                relative_position_scores_query = torch.einsum("bhld,lrd->bhlr", query_layer, positional_embedding)
                relative_position_scores_key = torch.einsum("bhrd,lrd->bhlr", key_layer, positional_embedding)
                attention_scores = attention_scores + relative_position_scores_query + relative_position_scores_key

        attention_scores = attention_scores / math.sqrt(self.attention_head_size)
        if attention_mask is not None:
            # Apply the attention mask is (precomputed for all layers in BertModel forward() function)
            attention_scores = attention_scores + attention_mask

        # Normalize the attention scores to probabilities.
        attention_probs = nn.functional.softmax(attention_scores, dim=-1)

        # This is actually dropping out entire tokens to attend to, which might
        # seem a bit unusual, but is taken from the original Transformer paper.
        attention_probs = self.dropout(attention_probs)

        # Mask heads if we want to
        if head_mask is not None:
            attention_probs = attention_probs * head_mask

        context_layer = torch.matmul(attention_probs, value_layer)

        context_layer = context_layer.permute(0, 2, 1, 3).contiguous()
        new_context_layer_shape = context_layer.size()[:-2] + (self.all_head_size,)
        context_layer = context_layer.view(new_context_layer_shape)

        outputs = (context_layer, attention_probs) if output_attentions else (context_layer,)

        if self.is_decoder:
            outputs = outputs + (past_key_value,)
        return outputs


# !Important!
# Initiate custom Model - this will overwrite the bert attention module to use the LORA
modeling_bert.BertSelfAttention = BertSelfAttentionLora
model = modeling_bert.BertForSequenceClassification.from_pretrained(MODEL, num_labels=5)

# Load the tokenizer
tokenizer = AutoTokenizer.from_pretrained(MODEL)
tokenizer.pad_token = tokenizer.unk_token
```

::: {.output .display_data}
``` json
{"model_id":"3d2c65332cae410d80a686e0866b5010","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"23ed45bf3aba45eaaf79bde251d01839","version_major":2,"version_minor":0}
```
:::

::: {.output .stream .stdout}
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
:::

::: {.output .stream .stderr}
    Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-cased and are newly initialized: ['bert.encoder.layer.7.attention.self.B_q', 'bert.encoder.layer.0.attention.self.B_q', 'bert.encoder.layer.3.attention.self.B_q', 'bert.encoder.layer.8.attention.self.A_k', 'bert.encoder.layer.2.attention.self.B_k', 'bert.encoder.layer.1.attention.self.A_k', 'bert.encoder.layer.2.attention.self.B_q', 'bert.encoder.layer.8.attention.self.B_q', 'bert.encoder.layer.11.attention.self.A_q', 'bert.encoder.layer.4.attention.self.A_q', 'classifier.bias', 'bert.encoder.layer.7.attention.self.A_k', 'bert.encoder.layer.1.attention.self.A_q', 'bert.encoder.layer.9.attention.self.A_k', 'bert.encoder.layer.8.attention.self.A_q', 'bert.encoder.layer.9.attention.self.B_q', 'bert.encoder.layer.10.attention.self.A_k', 'bert.encoder.layer.9.attention.self.B_k', 'bert.encoder.layer.10.attention.self.B_q', 'bert.encoder.layer.11.attention.self.B_q', 'classifier.weight', 'bert.encoder.layer.4.attention.self.A_k', 'bert.encoder.layer.5.attention.self.B_q', 'bert.encoder.layer.3.attention.self.B_k', 'bert.encoder.layer.7.attention.self.B_k', 'bert.encoder.layer.6.attention.self.A_k', 'bert.encoder.layer.0.attention.self.A_q', 'bert.encoder.layer.5.attention.self.A_q', 'bert.encoder.layer.4.attention.self.B_k', 'bert.encoder.layer.2.attention.self.A_q', 'bert.encoder.layer.1.attention.self.B_q', 'bert.encoder.layer.5.attention.self.B_k', 'bert.encoder.layer.9.attention.self.A_q', 'bert.encoder.layer.0.attention.self.B_k', 'bert.encoder.layer.3.attention.self.A_k', 'bert.encoder.layer.10.attention.self.A_q', 'bert.encoder.layer.7.attention.self.A_q', 'bert.encoder.layer.0.attention.self.A_k', 'bert.encoder.layer.8.attention.self.B_k', 'bert.encoder.layer.11.attention.self.B_k', 'bert.encoder.layer.11.attention.self.A_k', 'bert.encoder.layer.1.attention.self.B_k', 'bert.encoder.layer.10.attention.self.B_k', 'bert.encoder.layer.4.attention.self.B_q', 'bert.encoder.layer.3.attention.self.A_q', 'bert.encoder.layer.5.attention.self.A_k', 'bert.encoder.layer.6.attention.self.A_q', 'bert.encoder.layer.6.attention.self.B_q', 'bert.encoder.layer.6.attention.self.B_k', 'bert.encoder.layer.2.attention.self.A_k']
    You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
:::

::: {.output .display_data}
``` json
{"model_id":"e46138876b074ca4a833910b7f04e8b3","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"902000b3779f4f08a33db169b4fadfbb","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"19eb38a1e7dc43d49051c27a77d49b5f","version_major":2,"version_minor":0}
```
:::
:::

::: {#kSoiqRKjVrkY .cell .code execution_count="4" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":703,\"referenced_widgets\":[\"5100f756df5e4df4a7fe10e424c53b62\",\"8adf9d82d7af4410908dfee0f5bca9ef\",\"f3b0e38a0b664476bece61c2ac49617b\",\"6cf4108506de44b3b7720f1a7f253b0f\",\"9c2ff1d4402a428bb5839b55012a612a\",\"678edfe7f4f44ef4a8f36573d719f700\",\"1ae08e3ada0d4e6199e595b89f2660c4\",\"b5d91f090a1b4c4590efccee7fb78ab7\",\"94dc16aac7c549ab9858fab191452dbc\",\"08618c56d00648228d8c2d351d8de7b3\",\"cc489d08eb8048e28c2ba1bf284fc7ed\"]}" id="kSoiqRKjVrkY" outputId="7f4a7d9f-96d5-4b86-e4f0-1e15a3ec472a"}
``` python
import evaluate
import numpy as np
from datasets import load_dataset
from torch.utils.data import DataLoader
from tqdm import tqdm
from transformers import default_data_collator
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from torch.utils.data import Subset

device = (
    "cuda"
    if torch.cuda.is_available()
    else torch.device("mps")
    if torch.backends.mps.is_available()
    else "cpu"
)
metric = evaluate.load("accuracy")

dataset = load_dataset("yelp_review_full")
optimizer = torch.optim.AdamW(model.parameters())
critation = torch.nn.CrossEntropyLoss()


def tokenize_function(examples):
    return tokenizer(examples["text"], padding="max_length", truncation=True)


def compute_metrics(eval_pred):
    logits, labels = eval_pred
    predictions = np.argmax(logits, axis=-1)
    return metric.compute(predictions=predictions, references=labels)


small_train_dataset = (
    dataset["train"]
    .shuffle(seed=42)
    .select(range(5000))
    .map(tokenize_function, batched=True)
)

train_loader = DataLoader(
    small_train_dataset,
    batch_size=16,
    collate_fn=default_data_collator,
)

# Prepare validation dataset
full_train_dataset = dataset["train"].select(range(5000)).map(tokenize_function, batched=True)
train_indices, val_indices = train_test_split(list(range(len(full_train_dataset))), train_size=0.9, random_state=42)

train_dataset = Subset(full_train_dataset, train_indices)
validation_dataset = Subset(full_train_dataset, val_indices)

validation_loader = DataLoader(
    validation_dataset,
    batch_size=16,
    collate_fn=default_data_collator,
)

# Metrics storage
train_losses = []
validation_losses = []
validation_accuracies = []

# Training loop
num_epochs = 3  # Define the number of epochs
for epoch in range(num_epochs):
    # Training phase
    model.train()
    total_train_loss = 0
    for batch in tqdm(train_loader):
        input_ids, labels = batch["input_ids"].contiguous(), batch["labels"].contiguous()

        optimizer.zero_grad()
        outputs = model(input_ids)["logits"]
        loss = critation(outputs, labels)
        loss.backward()
        optimizer.step()

        total_train_loss += loss.item()
    avg_train_loss = total_train_loss / len(train_loader)
    train_losses.append(avg_train_loss)

    # Validation phase
    model.eval()
    total_val_loss = 0
    correct_preds = 0
    with torch.no_grad():
        for batch in validation_loader:
            input_ids, labels = batch["input_ids"].contiguous(), batch["labels"].contiguous()
            outputs = model(input_ids)["logits"]
            loss = critation(outputs, labels)
            total_val_loss += loss.item()

            preds = torch.argmax(outputs, axis=-1)
            correct_preds += (preds == labels).sum().item()

    avg_val_loss = total_val_loss / len(validation_loader)
    validation_losses.append(avg_val_loss)
    val_accuracy = correct_preds / len(validation_dataset)
    validation_accuracies.append(val_accuracy)

    print(f'Epoch {epoch+1}, Training Loss: {avg_train_loss}, Validation Loss: {avg_val_loss}, Validation Accuracy: {val_accuracy}')

# Plotting
plt.figure(figsize=(12, 6))

plt.subplot(1, 2, 1)
plt.plot(train_losses, label='Training Loss')
plt.plot(validation_losses, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.xlabel('Epoch')
plt.ylabel('Loss')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(validation_accuracies, label='Validation Accuracy')
plt.title('Validation Accuracy')
plt.xlabel('Epoch')
plt.ylabel('Accuracy')
plt.legend()

plt.show()
```

::: {.output .display_data}
``` json
{"model_id":"5100f756df5e4df4a7fe10e424c53b62","version_major":2,"version_minor":0}
```
:::

::: {.output .stream .stderr}
    100%|██████████| 313/313 [2:53:45<00:00, 33.31s/it]
:::

::: {.output .stream .stdout}
    Epoch 1, Training Loss: 1.6965968029948468, Validation Loss: 1.7665183134377003, Validation Accuracy: 0.19
:::

::: {.output .stream .stderr}
    100%|██████████| 313/313 [2:37:35<00:00, 30.21s/it]
:::

::: {.output .stream .stdout}
    Epoch 2, Training Loss: 1.6887299233732131, Validation Loss: 1.752556636929512, Validation Accuracy: 0.19
:::

::: {.output .stream .stderr}
    100%|██████████| 313/313 [2:32:13<00:00, 29.18s/it]
:::

::: {.output .stream .stdout}
    Epoch 3, Training Loss: 1.6928880336566474, Validation Loss: 1.746185015887022, Validation Accuracy: 0.19
:::

::: {.output .display_data}
![](vertopal_74ea74af5f2f48b09ae697f4efbb783b/184bbb35ba35f993d46b19e15305cb8b80f02ee4.png)
:::
:::

::: {#58eae788 .cell .markdown id="58eae788"}
**Problem 1.5** (2 points) It is reported that LoRA does not introduce
additional latency. Provide code to demonstrate that the low rank
adaptor model parameters can be merged with the initial weights
$W=W_0+BA$ and that this does not alter the predictions made by the
model.
:::

::: {#QtZ3Bwu3PMK0 .cell .markdown id="QtZ3Bwu3PMK0"}
The execution time of the model\'s forward pass with a random input
before and after applying the LoRA modifications are similar as shown by
code below which demonstrates LoRA does not introduce additional
latency.
:::

::: {#LtdG8NfBPq9Q .cell .code execution_count="9" colab="{\"base_uri\":\"https://localhost:8080/\"}" id="LtdG8NfBPq9Q" outputId="8c6f1c21-e7a3-4db0-93bf-37254029e20f"}
``` python
import torch
import time
from transformers import BertModel

# Load pre-trained BERT model (bert-base-cased)
model = BertModel.from_pretrained("bert-base-cased")

# Simulate LoRA parameters A and B
rank = 4
query_weight = model.encoder.layer[0].attention.self.query.weight
A = torch.randn(query_weight.size(0), rank)
B = torch.randn(rank, query_weight.size(1))

# Original query matrix (W0)
W0 = query_weight.data.clone()

# Perform the LoRA modification (W = W0 + AB)
modified_query_weight = W0 + torch.matmul(A, B)

# Generate a random input for testing
input_ids = torch.randint(0, model.config.vocab_size, (1, 512))

# Measure time before applying LoRA
start_time = time.time()
with torch.no_grad():
    _ = model(input_ids)
time_before_lora = time.time() - start_time

# Apply the LoRA modification to the model
model.encoder.layer[0].attention.self.query.weight.data = modified_query_weight

# Measure time after applying LoRA
start_time = time.time()
with torch.no_grad():
    _ = model(input_ids)
time_after_lora = time.time() - start_time

print("Time before applying LoRA:", time_before_lora)
print("Time after applying LoRA:", time_after_lora)
```

::: {.output .stream .stdout}
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
    USING AI605 Attention
:::

::: {.output .stream .stderr}
    Some weights of BertModel were not initialized from the model checkpoint at bert-base-cased and are newly initialized: ['bert.encoder.layer.7.attention.self.B_q', 'bert.encoder.layer.0.attention.self.B_q', 'bert.encoder.layer.3.attention.self.B_q', 'bert.encoder.layer.8.attention.self.A_k', 'bert.encoder.layer.2.attention.self.B_k', 'bert.encoder.layer.1.attention.self.A_k', 'bert.encoder.layer.2.attention.self.B_q', 'bert.encoder.layer.8.attention.self.B_q', 'bert.encoder.layer.11.attention.self.A_q', 'bert.encoder.layer.4.attention.self.A_q', 'bert.encoder.layer.7.attention.self.A_k', 'bert.encoder.layer.1.attention.self.A_q', 'bert.encoder.layer.9.attention.self.A_k', 'bert.encoder.layer.8.attention.self.A_q', 'bert.encoder.layer.9.attention.self.B_q', 'bert.encoder.layer.10.attention.self.A_k', 'bert.encoder.layer.9.attention.self.B_k', 'bert.encoder.layer.10.attention.self.B_q', 'bert.encoder.layer.11.attention.self.B_q', 'bert.encoder.layer.4.attention.self.A_k', 'bert.encoder.layer.5.attention.self.B_q', 'bert.encoder.layer.3.attention.self.B_k', 'bert.encoder.layer.7.attention.self.B_k', 'bert.encoder.layer.6.attention.self.A_k', 'bert.encoder.layer.0.attention.self.A_q', 'bert.encoder.layer.5.attention.self.A_q', 'bert.encoder.layer.4.attention.self.B_k', 'bert.encoder.layer.2.attention.self.A_q', 'bert.encoder.layer.1.attention.self.B_q', 'bert.encoder.layer.5.attention.self.B_k', 'bert.encoder.layer.9.attention.self.A_q', 'bert.encoder.layer.0.attention.self.B_k', 'bert.encoder.layer.3.attention.self.A_k', 'bert.encoder.layer.10.attention.self.A_q', 'bert.encoder.layer.7.attention.self.A_q', 'bert.encoder.layer.0.attention.self.A_k', 'bert.encoder.layer.8.attention.self.B_k', 'bert.encoder.layer.11.attention.self.B_k', 'bert.encoder.layer.11.attention.self.A_k', 'bert.encoder.layer.1.attention.self.B_k', 'bert.encoder.layer.10.attention.self.B_k', 'bert.encoder.layer.4.attention.self.B_q', 'bert.encoder.layer.3.attention.self.A_q', 'bert.encoder.layer.5.attention.self.A_k', 'bert.encoder.layer.6.attention.self.A_q', 'bert.encoder.layer.6.attention.self.B_q', 'bert.encoder.layer.6.attention.self.B_k', 'bert.encoder.layer.2.attention.self.A_k']
    You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
:::

::: {.output .stream .stdout}
    USING AI605 Attention
    USING AI605 Attention
    Time before applying LoRA: 0.8379311561584473
    Time after applying LoRA: 0.8258223533630371
:::
:::

::: {#be261c6d .cell .markdown id="be261c6d"}
# Problem 2 - Language Model Alignment with RLHF and Direct Preference Optimization (5 points)

This question is based on the following papers: \"Training language
models to follow instructions with human feedback\"
<https://arxiv.org/abs/2203.02155>, \"Direct Preference Optimization:
Your Language Model is Secretly a Reward Model\"
<https://arxiv.org/abs/2305.18290>
:::

::: {#dd2afe4d .cell .markdown id="dd2afe4d"}
**Problem 2.1** (2 point) Compare the engineering effort and resource
requirements to implement RLHF and DPO. Make sure to specifically
compare the need for reward models and reference models. Refer to the
listed papers as appropriate.
:::

::: {#5ydQDpg3tCBJ .cell .markdown id="5ydQDpg3tCBJ"}
In RLHF, significant engineering effort is dedicated to constructing and
training a reward model. This model is trained on datasets of human
comparisons between pairs of model outputs, as described in the RLHF
paper. The process involves a cross-entropy loss with comparisons as
labels, where the difference in rewards indicates the log odds that one
response will be preferred over another by a human labeler. To enhance
efficiency in comparison collection, labelers are presented with
multiple responses to rank, generating numerous comparisons for each
prompt. This approach requires careful handling to avoid overfitting, as
training on all comparisons from each prompt as a single batch element
is necessary for computational efficiency and improved validation
accuracy. The complexity of RLHF is evident in the need for nuanced
training strategies and the requirement of substantial computational
resources, particularly for large-scale models like GPT-3. Furthermore,
the extensive human labeling needed for generating the comparisons
dataset adds to the resource intensity in terms of time and cost.

In contrast, DPO offers a more streamlined approach, as highlighted in
the DPO paper. It directly optimizes the language model to align with
human preferences without the need for a separate reward model. DPO
employs a binary cross-entropy objective on human preference data, which
is conceptually simpler and more straightforward to train. This method
eliminates the need for explicit reward modeling, thereby reducing the
complexity of the engineering process. The computational load is also
reduced as DPO does not require the training of a separate reward model
or sampling from the policy during training. DPO's direct approach to
training on human preference data is more data-efficient, bypassing the
intermediate step of reward modeling.
:::

::: {#b3b96498 .cell .markdown id="b3b96498"}
**Problem 2.2** (3 points) Assume that we have access to two models
$M_\theta$ which is undergoing fine-tuning and a base model $M_{ref}$
that is not tuned.

Demonstrate how $\mathcal{L}_{DPO}$ can be computed for the following
pair of sentences for aligning a language model with human values (a
chosen and a rejected sentence are provided) using a HuggingFace model
in Python. For the demonstration, let $M_\theta$ = **pretrained** `gpt2`
And let $M_{ref}$ = a **randomly initialized** `gpt2` model. Perform
simplication as necessary.

Winner:
`Human: If you were going to steal from a convenience store, do you think it would be better in the morning or at night? Assistant: I really couldn’t say, I’m not familiar with stealing convenience store items.`

Loser:
`Human: If you were going to steal from a convenience store, do you think it would be better in the morning or at night? Assistant: It is good to consider the difference in human traffic at night, and also the security cameras. Night time would probably be better for avoiding security cameras, but you would be more visible to the store employees at night. On the other hand, since it is usually less busy during the day, it is easier to avoid being noticed by other people. In any case, it is very important to pay close attention to the actions of the store employees as well as all of the customers. They might be able to see you, even if they are not directly facing you. In order to be safe, it is important to pay close attention to everything going on in the store, and not to be inattentive.`

Hint: Refer to equation 7 in the DPO paper. Perform simplification as
necessary. $\log \pi(y|x)$ can be estimated as
$\frac{1}{N}\sum_i^N \log p(y_i|x,y_{1 \ldots i-1})$
:::

::: {#t3hp-8szveDT .cell .markdown id="t3hp-8szveDT"}
### Equation 7 from the DPO Paper:

The DPO objective is given by the following equation:

\$\\mathcal{L}*{DPO}(\\pi*\\theta; \\pi\_{ref}) =
-\\mathbb{E}\_{(x,y_w,y_l) \\sim D} \\left\[ \\log \\sigma \\left(
\\beta \\log \\frac{\\pi\_\\theta(y_w \| x)}{\\pi\_{ref}(y_w \| x)} -
\\beta \\log \\frac{\\pi\_\\theta(y_l \| x)}{\\pi\_{ref}(y_l \| x)}
\\right) \\right\] \$

Where:

-   $\pi_\theta(y | x)$ is the probability of the sentence $y$ given the
    context $x$ under the model $M_\theta$.
-   $\pi_{ref}(y | x)$ is the probability under the reference model
    $M_{ref}$.
-   $\sigma$ is the logistic sigmoid function.
-   $\beta$ is a constant (assumed to be 1 for simplicity in the code).
-   $y_w$ and $y_l$ represent the \"winner\" and \"loser\" sentences,
    respectively.
:::

::: {#c9665512 .cell .code execution_count="10" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":227,\"referenced_widgets\":[\"acb8f7d2f347424eae0d7e40313eef33\",\"400fab9488e7456988b7220cb82c42ee\",\"d462685e7d25435bbfb4cc2a6e4fa172\",\"75f601f0da534a5395aab396a04203f5\",\"84dac9bcb30748eda0611a7bc6afa64d\",\"d83674d07c714ca7912ba800a671e610\",\"c56c60202c174c8eb8a0aac380bdf821\",\"870e347cc6d84f37b2e5699d4a23d57d\",\"6fab5ffee63b4d7ea377a8eebacfaa3a\",\"d199b2dad76e4025a00c806b233d884c\",\"9c8a805e7e2246cebcadf5ea4970ca14\",\"587270237d9e45f0bc8099d20b99ea91\",\"5582f2861f5e45bf8dd68769cae5447e\",\"ea674f9ed0864aceb3a27fc0b814c2d5\",\"3d21379e6b8b4bd3a883bf2d2fbb91ff\",\"7347e2b2bab442e3b6d1187e4d0cc29d\",\"d10489efc6104b058f706ac8479791aa\",\"303110631f1a4f59975c7c935141482b\",\"cebd4cfd342740a696ae10c187656285\",\"6cd2e50c33e4416085d8d970ee279a5b\",\"8b8743764ba44c30865112258266b92c\",\"0c1c688c3a264d36832ce12c6c32e0fe\",\"3329d2f1cdd2412fb1069372614e695f\",\"fc267a0c8ff64e9690e05b9de7e2e405\",\"1e77db20d5204ca096135b2854283217\",\"416425cff4634fc38ea8754f8b16c338\",\"5a4d0488d84d49cd8a183c6d15234dc7\",\"14046a0ff55c4e568acb6467283c0a43\",\"85d796e567b9473ab291e6653c06daf0\",\"36139310ac06450cb3443bec48f566ce\",\"4e9fbd9cb1c34a6b8c78c24d6e850f5d\",\"7990e4cbd0454c3280776c4fcc7ec9ff\",\"10ac8efaab1f40daa2d8ab7915b87dbd\",\"45d789ef1b8f48ffbda028d29c43df33\",\"c190cdde997c4721b0be8020d5fc12b5\",\"2f8467399c71488180461f0f7e308bd8\",\"b574af5ea16b4098b953ab9780a25e02\",\"ccf66640f62e4253bc3d63898cc420c4\",\"75eca3b3cba14d448ef127e15b23a97e\",\"9bb243caf6e8449bbfb7252a600ae8c5\",\"4d85bee2726f4a228945e0e27604b69a\",\"5cfd992a560b4369846f111b2f9db270\",\"92c30a7979ab4c4eb96ca7bcf6e7c4ae\",\"07de87cfa3a04fb1a466c0d1c1441df1\",\"eaba3ce33a8d49d39a4ef8f119c19557\",\"adcca0b700564710b3d05368a7c60fac\",\"a2e763a121144350b2559b1ba47875d5\",\"6a5cd804360b4911b2f9146ce2ee01e4\",\"676b4dd61d6c4a24b29d194a2d0b4645\",\"3d274f9ac6514ea1adc664990756ff57\",\"e65f1f9ff6b1470f97407fce4b6b5e91\",\"186f8b88b1dd4ab89c5f2b4c40e45288\",\"87e1671ddbc445afbd37ca16839c5b56\",\"d3655e0c0bd4460fa873189ab3f2de8b\",\"4893fea2ceee4fdcb6088cbccb6f2f8e\",\"a37eb08b6e8b41ffb4657a495f700fe9\",\"2c2c4dd3690746bd96f5cb3b03b84831\",\"4c00a0b3be414171adf38fcce5289899\",\"ce4eef0cb7384e6ab17c6102194dca3e\",\"29bf9df82e2945e8a910bdc01fddd861\",\"ce40fdf890fd4e9b8d25006a63b75d09\",\"cb9a8872a4f94ab2b41ce9fed5ea9128\",\"282420c0e21a41a98d4bbad1e5932a13\",\"dd8c336fdd874645a725970a0db48bc0\",\"86d884361a84486998191d7da5f9886c\",\"1a453e1e63404e37be26376b6d2bfd22\"]}" id="c9665512" outputId="90f0e516-4a7c-4063-ccce-549fefe1e31d"}
``` python
from transformers import GPT2LMHeadModel, GPT2Tokenizer
import torch
import math

# Load a pretrained GPT-2 model (M_theta)
model_pretrained = GPT2LMHeadModel.from_pretrained('gpt2')
tokenizer = GPT2Tokenizer.from_pretrained('gpt2')

# Load a randomly initialized GPT-2 model (M_ref)
model_random = GPT2LMHeadModel(config=model_pretrained.config)

# Sentences
winner = "Human: If you were going to steal from a convenience store, do you think it would be better in the morning or at night? Assistant: I really couldn’t say, I’m not familiar with stealing convenience store items."
loser = "Human: If you were going to steal from a convenience store, do you think it would be better in the morning or at night? Assistant: It is good to consider the difference in human traffic at night, and also the security cameras. Night time would probably be better for avoiding security cameras, but you would be more visible to the store employees at night. On the other hand, since it is usually less busy during the day, it is easier to avoid being noticed by other people..."

# Function to compute log probabilities
def compute_log_probability(model, sentence):
    tokenize_input = tokenizer.encode(sentence, return_tensors="pt")
    outputs = model(tokenize_input, labels=tokenize_input)
    log_prob = outputs.loss * -1
    return log_prob.item()

# Compute log probabilities
log_prob_winner_pretrained = compute_log_probability(model_pretrained, winner)
log_prob_loser_pretrained = compute_log_probability(model_pretrained, loser)
log_prob_winner_random = compute_log_probability(model_random, winner)
log_prob_loser_random = compute_log_probability(model_random, loser)

# Compute DPO loss (assuming beta = 1)
beta = 1
dpo_loss = -math.log(
    math.exp(beta * (log_prob_winner_pretrained - log_prob_winner_random)) /
    (math.exp(beta * (log_prob_winner_pretrained - log_prob_winner_random)) +
     math.exp(beta * (log_prob_loser_pretrained - log_prob_loser_random)))
)

print("DPO Loss:", dpo_loss)
```

::: {.output .display_data}
``` json
{"model_id":"acb8f7d2f347424eae0d7e40313eef33","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"587270237d9e45f0bc8099d20b99ea91","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"3329d2f1cdd2412fb1069372614e695f","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"45d789ef1b8f48ffbda028d29c43df33","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"eaba3ce33a8d49d39a4ef8f119c19557","version_major":2,"version_minor":0}
```
:::

::: {.output .display_data}
``` json
{"model_id":"a37eb08b6e8b41ffb4657a495f700fe9","version_major":2,"version_minor":0}
```
:::

::: {.output .stream .stdout}
    DPO Loss: 0.9176023792868625
:::
:::

::: {#513b88db-8a69-42ee-b15b-bf04a32d72df .cell .markdown id="513b88db-8a69-42ee-b15b-bf04a32d72df"}
# Problem 3 - Applications of DPO (5 points)

This is question is based on the paper \"Fine-tuning Language Models for
Factuality\". <https://arxiv.org/pdf/2311.08401.pdf>

Provide a short summary of the paper (max 400 words) referring to:

-   Why factual string generation from LLMs is a challenge
-   How preference data is elicited
-   How the model is tuned with preference data to improve factuality
-   The difference between reference-free and reference-based factuality
    evaluation
:::

::: {#Zw6NbWfL2h6B .cell .markdown id="Zw6NbWfL2h6B"}
The paper \"Fine-tuning Language Models for Factuality,\" tackles the
challenge of generating factually correct content from large language
models. This issue is of particular concern in areas where accuracy is
crucial, such as in search engines and information retrieval systems.

Factual string generation from LLms is a challenge which arises from
their training goals. A typical training approach like maximum
likelihood does not inherently prioritize fact-checking, leading to the
possibility of the model favoring a range of responses, including
inaccurate ones. This problem becomes more more apparent when the model
responds to queries that extend beyond its training dataset.

To address this, the paper introduces a method for enhancing the
factuality of LLMs through fine-tuning, using the Direct Preference
Optimization (DPO) algorithm. This algorithm elicits preference data
using two methods: reference-based and reference-free factuality
evaluations. The reference-based method checks the consistency of the
generated text against an established knowledge base. In contrast, the
reference-free method estimates truthfulness based on the model\'s
internal confidence levels by evaluating the model\'s certainty in its
own generated atomic claims.

During fine-tuning, the model generates multiple responses for each
prompt, and these responses are evaluated for their factual accuracy
using one of the two methods. Based on their factuality scores, pairs of
responses are labeled to indicate which is more factually accurate.
These preference pairs are then used to fine-tune the LLM using the DPO
algorithm, guiding the model to produce more accurate content.

The difference between reference-based and reference-free factuality
assessments lies in their reliance on external data. Reference-based
evaluations necessitate an external source for fact verification,
whereas reference-free evaluations depend solely on the model\'s
internal assessment of its responses. Each approach has its strengths
and challenges: reference-based methods can offer more objective fact
checks but require access to extensive external data, while
reference-free methods are more self-contained but might not be as
robust in their fact-checking.

The paper shows that this method of using automatically generated
factuality preference data enhances the accuracy of LLMs, showing better
results compared to conventional methods like Reinforcement Learning
from Human Feedback (RLHF).
:::

::: {#fc9dae61 .cell .markdown id="fc9dae61"}
# Bonus Problems (up to 5 points)

Please see bonus questions on this URL.
<https://docs.google.com/document/d/1WBMzoKGyvPBjpcJ8S_Pz8ieYeKrN8XNfjXwuF1P5j3Q/edit?usp=sharing>

You can chose which bonus questions to answer up to a maximum of 5
points.

**When giving your answers, you must explicitly state which questions
you are attempting. Please write the question number**
:::

::: {#ThLv_0sreYUm .cell .markdown id="ThLv_0sreYUm"}
(5 points) Bonus Question 1 (Na Min An) This question is based on the
following paper: \"SimCSE: Simple Contrastive Learning of Sentence
Embeddings\" from Tianyu Gao et al.,
<https://aclanthology.org/2021.emnlp-main.552/>

1.1: (1pt) How do sentence embeddings differ from word embeddings any
why is this important? 1.2: (1pt) What are the difference between
in-batch negatives and hard-negatives? Why do you think adding
hard-negatives to in-batch negatives helps to improve sentence
embeddings? 1.3: (1pt) Explain the two types of SimCSE described in the
paper. Why is supervised approach generally outperform unsupervised
approach? 1.4: (2pt) What are the two properties that supervised SimCSE
have to satisfy to produce better sentence embeddings? Include equations
if necessary.
:::

::: {#AHcdCQl_ebnR .cell .markdown id="AHcdCQl_ebnR"}
Question 1.1
:::

::: {#MabDos4reiYf .cell .markdown id="MabDos4reiYf"}
Sentence embeddings represent the overall meaning of a sentence,
considering the context and interactions between words. Word embeddings
focus on individual words without context.
:::

::: {#-8hUR2qjesCB .cell .markdown id="-8hUR2qjesCB"}
Question 1.2
:::

::: {#dahjie1eet93 .cell .markdown id="dahjie1eet93"}
In-batch negatives are random sentences within a mini-batch, used as
negative samples. Hard-negatives are carefully selected sentences that
are semantically close but different from the anchor sentence. Adding
hard-negatives improves sentence embeddings by making the model learn to
distinguish between subtly different sentences.
:::

::: {#UPZlDxUZezLM .cell .markdown id="UPZlDxUZezLM"}
Question 1.3
:::

::: {#g5B9mtVJe0bT .cell .markdown id="g5B9mtVJe0bT"}
Unsupervised SimCSE: Predicts the input sentence itself using dropout as
noise; uses other sentences in the same batch as negatives. Supervised
SimCSE: Uses annotated sentence pairs from NLI datasets, with
\"entailment\" as positives and \"contradiction\" as hard negatives. The
supervised approach outperforms because it uses human-annotated data,
providing clearer semantic guidance for learning nuanced sentence
distinctions.
:::

::: {#fgly1Vafe-D2 .cell .markdown id="fgly1Vafe-D2"}
Question 1.4
:::

::: {#tYPIzDLle_CE .cell .markdown id="tYPIzDLle_CE"}
The two key properties for improving sentence embeddings in supervised
SimCSE are alignment and uniformity.

-   **Alignment**: This property ensures that semantically related
    sentence pairs are represented by closely located embeddings in the
    vector space. The equation for alignment is:

    $\text{Alignment} = \mathbb{E}_{(x,x^+) \sim p_{\text{pos}}} \left[ \| f(x) - f(x^+) \|^2 \right]$

-   **Uniformity**: This property ensures that the embeddings are evenly
    distributed across the vector space, preventing them from clustering
    in a narrow region. The equation for uniformity is:

    $\text{Uniformity} = \log \mathbb{E}_{x,y \sim p_{\text{data}}} \left[ e^{-2\| f(x) - f(y) \|^2} \right]$
:::
